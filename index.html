<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticker Intel - Reddit Stock Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --text-primary: #ffffff;
            --text-secondary: #98989d;
            --accent-green: #30d158;
            --accent-red: #ff453a;
            --accent-blue: #007aff;
            --accent-orange: #ff9500;
            --accent-purple: #bf5af2;
            --border-color: #2c2c2e;
            --card-bg: rgba(28, 28, 30, 0.8);
            
            --font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --radius: 16px;
            --spacing: 1rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-primary);
            font-family: var(--font-family);
            color: var(--text-primary);
            line-height: 1.4;
            -webkit-font-smoothing: antialiased;
        }

        .header {
            text-align: center;
            padding: 3rem 1rem 1rem;
            background: linear-gradient(180deg, var(--bg-primary) 0%, rgba(0,0,0,0.95) 100%);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.03em;
        }

        .header p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-bottom: 1rem;
        }

        .ticker-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .stat-box {
            background: var(--card-bg);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            backdrop-filter: blur(20px);
            text-align: center;
            min-width: 120px;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1.5rem 1rem;
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 0.5rem;
            border: 1px solid var(--border-color);
        }

        .filter-tab {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 0.75rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .filter-tab.active {
            background: var(--accent-blue);
            color: white;
        }

        .filter-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 4rem;
            gap: 1rem;
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .feed {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1rem 4rem;
        }

        .stock-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            margin-bottom: 1rem;
            padding: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            position: relative;
        }

        .stock-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .ticker-badge {
            background: var(--accent-blue);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .ticker-badge.penny {
            background: var(--accent-orange);
        }

        .ticker-badge.undervalued {
            background: var(--accent-green);
        }

        .ticker-badge.speculative {
            background: var(--accent-purple);
        }

        .mention-count {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .stock-title {
            font-size: 1.2rem;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            text-decoration: none;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .stock-title:hover {
            color: var(--accent-blue);
        }

        .ticker-highlights {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .ticker-tag {
            background: rgba(0, 122, 255, 0.2);
            color: var(--accent-blue);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid rgba(0, 122, 255, 0.3);
        }

        .price-tag {
            background: rgba(48, 209, 88, 0.2);
            color: var(--accent-green);
            border: 1px solid rgba(48, 209, 88, 0.3);
        }

        .target-tag {
            background: rgba(255, 149, 0, 0.2);
            color: var(--accent-orange);
            border: 1px solid rgba(255, 149, 0, 0.3);
        }

        .stock-excerpt {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .stock-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .stock-stats {
            display: flex;
            gap: 1rem;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stock-source {
            font-weight: 500;
        }

        .refresh-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            background: var(--accent-blue);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 122, 255, 0.3);
            z-index: 1000;
        }

        .refresh-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 122, 255, 0.4);
        }

        .error {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--accent-red);
            max-width: 600px;
            margin: 0 auto;
        }

        .error h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .error p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .ticker-stats {
                gap: 1rem;
            }
            
            .filter-tabs {
                margin: 1rem 0.5rem;
            }
            
            .feed {
                padding: 0 0.75rem 4rem;
            }
            
            .stock-card {
                padding: 1.25rem;
            }
            
            .stock-header {
                flex-direction: column;
                gap: 0.75rem;
                align-items: flex-start;
            }
            
            .stock-meta {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>Ticker Intel</h1>
        <p>Most discussed undervalued & penny stocks from Reddit</p>
        
        <div class="ticker-stats">
            <div class="stat-box">
                <div class="stat-number" id="total-tickers">0</div>
                <div class="stat-label">Tickers Found</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="penny-count">0</div>
                <div class="stat-label">Penny Stocks</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="undervalued-count">0</div>
                <div class="stat-label">Undervalued</div>
            </div>
        </div>

        <div class="filter-tabs">
            <button class="filter-tab active" onclick="filterStocks('all')">All Stocks</button>
            <button class="filter-tab" onclick="filterStocks('penny')">Penny Stocks</button>
            <button class="filter-tab" onclick="filterStocks('undervalued')">Undervalued</button>
            <button class="filter-tab" onclick="filterStocks('trending')">Most Discussed</button>
        </div>
    </header>

    <main class="feed">
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <span>Scanning for ticker symbols...</span>
        </div>
        
        <div id="stocks" style="display: none;"></div>
        <div id="error" style="display: none;"></div>
    </main>

    <button class="refresh-button" onclick="loadStocks()" title="Refresh">
        â†»
    </button>

    <script>
        const SUBREDDITS = ['pennystocks', 'UndervaluedStonks', 'ValueInvesting', 'wallstreetbets', 'stocks', 'StockMarket'];
        
        // Enhanced ticker extraction patterns
        const TICKER_PATTERNS = [
            /\$([A-Z]{1,5})\b/g,  // $AAPL format
            /\b([A-Z]{2,5})\s+(?:stock|shares|calls|puts|position)/gi,  // AAPL stock
            /\b([A-Z]{2,5})\s+(?:to|at|hit|target|price)/gi,  // AAPL to $150
            /(?:ticker|symbol):\s*([A-Z]{2,5})/gi,  // ticker: AAPL
            /\b([A-Z]{2,5})\s+(?:\$\d+)/g,  // AAPL $150
        ];

        // Keywords that indicate value/penny stocks
        const VALUE_KEYWORDS = ['undervalued', 'undervalue', 'cheap', 'bargain', 'discount', 'value play', 'fundamentals', 'pe ratio', 'book value'];
        const PENNY_KEYWORDS = ['penny stock', 'under $5', 'under $1', 'micro cap', 'small cap', 'otc'];
        const PRICE_PATTERNS = /\$(\d+(?:\.\d{2})?)/g;
        const TARGET_PATTERNS = /(?:target|pt|price target).*?\$(\d+(?:\.\d{2})?)/gi;

        let allStocks = [];
        let currentFilter = 'all';

        function extractTickers(text) {
            const tickers = new Set();
            
            TICKER_PATTERNS.forEach(pattern => {
                const matches = text.matchAll(pattern);
                for (const match of matches) {
                    const ticker = match[1].toUpperCase();
                    // Filter out common false positives
                    if (ticker.length >= 2 && ticker.length <= 5 && 
                        !['THE', 'AND', 'FOR', 'ARE', 'BUT', 'NOT', 'YOU', 'ALL', 'CAN', 'HER', 'WAS', 'ONE', 'OUR', 'OUT', 'DAY', 'GET', 'HAS', 'HIM', 'HIS', 'HOW', 'ITS', 'MAY', 'NEW', 'NOW', 'OLD', 'SEE', 'TWO', 'WHO', 'BOY', 'DID', 'ITS', 'LET', 'PUT', 'SAY', 'SHE', 'TOO', 'USE'].includes(ticker)) {
                        tickers.add(ticker);
                    }
                }
            });
            
            return Array.from(tickers);
        }

        function extractPriceInfo(text) {
            const prices = [];
            const targets = [];
            
            const priceMatches = text.matchAll(PRICE_PATTERNS);
            for (const match of priceMatches) {
                prices.push(parseFloat(match[1]));
            }
            
            const targetMatches = text.matchAll(TARGET_PATTERNS);
            for (const match of targetMatches) {
                targets.push(parseFloat(match[1]));
            }
            
            return { prices, targets };
        }

        function analyzeStockType(text, tickers) {
            const lowerText = text.toLowerCase();
            const { prices, targets } = extractPriceInfo(text);
            
            let type = 'speculative';
            const tags = [];
            
            // Check for value indicators
            if (VALUE_KEYWORDS.some(keyword => lowerText.includes(keyword))) {
                type = 'undervalued';
                tags.push('Value Play');
            }
            
            // Check for penny stock indicators
            if (PENNY_KEYWORDS.some(keyword => lowerText.includes(keyword)) || 
                prices.some(price => price < 5)) {
                type = 'penny';
                tags.push('Penny Stock');
            }
            
            // Add price tags
            if (prices.length > 0) {
                const avgPrice = prices.reduce((a, b) => a + b) / prices.length;
                tags.push(`$${avgPrice.toFixed(2)}`);
            }
            
            // Add target tags
            if (targets.length > 0) {
                const avgTarget = targets.reduce((a, b) => a + b) / targets.length;
                tags.push(`PT: $${avgTarget.toFixed(2)}`);
            }
            
            return { type, tags };
        }

        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = Math.floor((now - timestamp) / 1000);
            
            if (diff < 60) return `${diff}s`;
            if (diff < 3600) return `${Math.floor(diff / 60)}m`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h`;
            return `${Math.floor(diff / 86400)}d`;
        }

        function formatNumber(num) {
            if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`;
            if (num >= 1000) return `${(num / 1000).toFixed(1)}k`;
            return num.toString();
        }

        async function fetchSubreddit(subreddit, limit = 15) {
            try {
                const response = await fetch(`https://www.reddit.com/r/${subreddit}/hot.json?limit=${limit}`);
                if (!response.ok) throw new Error(`Failed to fetch r/${subreddit}`);
                
                const data = await response.json();
                const posts = [];
                
                data.data.children.forEach(post => {
                    const postData = post.data;
                    const fullText = `${postData.title} ${postData.selftext || ''}`;
                    const tickers = extractTickers(fullText);
                    
                    if (tickers.length > 0) {
                        const analysis = analyzeStockType(fullText, tickers);
                        
                        posts.push({
                            title: postData.title,
                            url: `https://reddit.com${postData.permalink}`,
                            source: `r/${subreddit}`,
                            publishedAt: postData.created_utc * 1000,
                            description: postData.selftext || '',
                            score: postData.score,
                            comments: postData.num_comments,
                            author: postData.author,
                            tickers: tickers,
                            stockType: analysis.type,
                            tags: analysis.tags,
                            mentionCount: tickers.length
                        });
                    }
                });
                
                return posts;
            } catch (error) {
                console.error(`Error fetching r/${subreddit}:`, error);
                return [];
            }
        }

        async function fetchAllStocks() {
            const allPosts = [];
            
            for (const subreddit of SUBREDDITS) {
                const posts = await fetchSubreddit(subreddit, 10);
                allPosts.push(...posts);
            }
            
            // Group by primary ticker and sort by engagement
            const tickerGroups = {};
            allPosts.forEach(post => {
                const primaryTicker = post.tickers[0];
                if (!tickerGroups[primaryTicker]) {
                    tickerGroups[primaryTicker] = [];
                }
                tickerGroups[primaryTicker].push(post);
            });
            
            // Get best post for each ticker
            const bestPosts = Object.entries(tickerGroups).map(([ticker, posts]) => {
                const bestPost = posts.sort((a, b) => (b.score + b.comments * 2) - (a.score + a.comments * 2))[0];
                bestPost.totalMentions = posts.length;
                bestPost.primaryTicker = ticker;
                return bestPost;
            });
            
            return bestPosts.sort((a, b) => (b.score + b.comments * 3 + b.totalMentions * 50) - (a.score + a.comments * 3 + a.totalMentions * 50));
        }

        function updateStats(stocks) {
            const totalTickers = stocks.length;
            const pennyCount = stocks.filter(s => s.stockType === 'penny').length;
            const undervaluedCount = stocks.filter(s => s.stockType === 'undervalued').length;
            
            document.getElementById('total-tickers').textContent = totalTickers;
            document.getElementById('penny-count').textContent = pennyCount;
            document.getElementById('undervalued-count').textContent = undervaluedCount;
        }

        function createStockCard(stock) {
            const timeAgo = getTimeAgo(stock.publishedAt);
            const excerpt = stock.description.slice(0, 180) + (stock.description.length > 180 ? '...' : '');
            
            const tickerTags = stock.tickers.map(ticker => 
                `<span class="ticker-tag">${ticker}</span>`
            ).join('');
            
            const priceTags = stock.tags.map(tag => {
                let className = 'ticker-tag';
                if (tag.startsWith('$')) className += ' price-tag';
                if (tag.startsWith('PT:')) className += ' target-tag';
                return `<span class="${className}">${tag}</span>`;
            }).join('');
            
            return `
                <article class="stock-card" data-type="${stock.stockType}">
                    <div class="stock-header">
                        <div class="ticker-badge ${stock.stockType}">
                            ${stock.primaryTicker}
                        </div>
                        <div class="mention-count">
                            ${stock.totalMentions} mentions
                        </div>
                    </div>
                    
                    <a href="${stock.url}" target="_blank" class="stock-title">
                        ${stock.title}
                    </a>
                    
                    <div class="ticker-highlights">
                        ${tickerTags}
                        ${priceTags}
                    </div>
                    
                    ${excerpt ? `<p class="stock-excerpt">${excerpt}</p>` : ''}
                    
                    <div class="stock-meta">
                        <div class="stock-stats">
                            <div class="stat">â†‘ ${formatNumber(stock.score)}</div>
                            <div class="stat">ðŸ’¬ ${formatNumber(stock.comments)}</div>
                        </div>
                        <div>
                            <span class="stock-source">${stock.source}</span>
                            <span> â€¢ ${timeAgo}</span>
                        </div>
                    </div>
                </article>
            `;
        }

        function filterStocks(filter) {
            currentFilter = filter;
            
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            applyFilter(filter);
        }

        function applyFilter(filter) {
            const cards = document.querySelectorAll('.stock-card');
            
            cards.forEach(card => {
                let show = true;
                
                switch(filter) {
                    case 'penny':
                        show = card.dataset.type === 'penny';
                        break;
                    case 'undervalued':
                        show = card.dataset.type === 'undervalued';
                        break;
                    case 'trending':
                        // Show top 10 most discussed
                        const index = Array.from(cards).indexOf(card);
                        show = index < 10;
                        break;
                }
                
                card.style.display = show ? 'block' : 'none';
            });
        }

        function displayStocks(stocks) {
            const container = document.getElementById('stocks');
            container.innerHTML = stocks.map(createStockCard).join('');
            updateStats(stocks);
            applyFilter(currentFilter);
        }

        function showError(message) {
            const errorContainer = document.getElementById('error');
            errorContainer.innerHTML = `
                <div class="error">
                    <h3>Unable to load stock data</h3>
                    <p>${message}</p>
                </div>
            `;
            errorContainer.style.display = 'block';
        }

        async function loadStocks() {
            const loading = document.getElementById('loading');
            const stocks = document.getElementById('stocks');
            const error = document.getElementById('error');
            
            loading.style.display = 'flex';
            stocks.style.display = 'none';
            error.style.display = 'none';
            
            try {
                const data = await fetchAllStocks();
                allStocks = data;
                
                displayStocks(data);
                
                loading.style.display = 'none';
                stocks.style.display = 'block';
                
            } catch (err) {
                console.error('Error loading stocks:', err);
                loading.style.display = 'none';
                showError('Failed to load stock discussions. Please try again.');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadStocks);
        
        // Auto-refresh every 10 minutes
        setInterval(loadStocks, 600000);
        
        // Keyboard shortcut
        document.addEventListener('keydown', (e) => {
            if (e.key === 'r' && !e.ctrlKey && !e.metaKey) {
                loadStocks();
            }
        });
    </script>
</body>
</html>